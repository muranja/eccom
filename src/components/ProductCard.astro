---
/**
 * Product Card Component
 * Displays a product card with responsive image and actions
 */
import ResponsiveImage from "./ResponsiveImage.astro";
import Icon from "./Icon.astro";
import Badge from "./Badge.astro";
import { AddToCartButton } from "./AddToCartButton";
import { SITE_CONFIG, getProductWhatsAppUrl } from "../config/site";

const { product } = Astro.props;

// Generate WhatsApp URL
const whatsappUrl = getProductWhatsAppUrl(
    product.data.name,
    product.data.price,
);
---

<div
    class="group relative p-4 border border-slate-100 rounded-xl shadow-sm hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 bg-white overflow-hidden flex flex-col"
>
    <!-- Product Image with Responsive Loading -->
    <a
        href={`/shop/${product.slug}`}
        class="block"
        aria-label={`View ${product.data.name} details`}
    >
        <div
            class="relative h-48 w-full mb-4 bg-gray-50 rounded-lg overflow-hidden flex items-center justify-center"
        >
            {
                product.data.image ? (
                    <ResponsiveImage
                        src={product.data.image}
                        alt={product.data.name}
                        loading="lazy"
                        width={300}
                        height={192}
                        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
                        class="object-cover w-full h-full group-hover:scale-105 transition-transform duration-500"
                    />
                ) : (
                    <span class="text-gray-500">No Image</span>
                )
            }
        </div>
    </a>

    <!-- Product Info -->
    <div class="flex flex-col flex-grow">
        <div class="mb-2">
            <Badge variant="category">
                {product.data.category}
            </Badge>
        </div>
        <a href={`/shop/${product.slug}`}>
            <h3
                class="font-bold text-lg text-slate-900 leading-tight hover:text-emerald-700 transition-colors mb-2"
            >
                {product.data.name}
            </h3>
        </a>
        <p class="text-slate-900 font-extrabold text-xl mb-auto">
            <span class="text-sm font-normal text-gray-500 mr-1">KES</span>{
                product.data.price.toLocaleString()
            }
        </p>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-2 mt-4">
        <div class="flex-1">
            <AddToCartButton
                client:load
                product={{ id: product.slug, ...product.data }}
            />
        </div>
        <a
            href={whatsappUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded flex items-center justify-center transition-all active:scale-95 shadow-sm shrink-0"
            title="Chat on WhatsApp"
            aria-label="Chat on WhatsApp"
        >
            <Icon name="whatsapp" class="h-5 w-5" />
        </a>
    </div>
</div>
